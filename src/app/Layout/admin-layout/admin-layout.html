

<!-- Sidebar -->
<div class="l-navbar" [ngClass]="{ 'collapsed': !isSidebarExpanded }">
  <nav class="nav">
    <div>
      <div class="nav-brand">
        <a  routerLink="/company" class="nav-logo" *ngIf="isSidebarExpanded">
          <img src="images/logo-vf.png" alt="logo" width="40"/>
        </a>
        <i class='bx bx-menu-alt-right nav-toggle' (click)="toggleSidebar()"></i>
      </div>

      <div class="menu-scroll flex-grow-1 overflow-auto">
        <ul class="list-unstyled mb-0 px-0">
          <ng-container *ngTemplateOutlet="renderMenu; context: { items: menuItems, isRoot: true }"></ng-container>
        </ul>
      </div>

      <!-- <div class="mt-auto">
        <div class="menu-item text-white" (click)="logout()">
          <span class="label-content">
            <div class="icon-container me-1">
              <i class="fa-solid fa-right-from-bracket me-2"></i>
            </div>
            <span *ngIf="isSidebarExpanded">Logout</span>
          </span>
        </div>
      </div> -->
  
    </div>
  </nav>
</div>




<div class="main-content" [ngClass]="{ 'body-pd': !isSidebarExpanded }">
  <div class="header">
    <div class="header-card">
    <div class="d-flex align-items-center justify-content-between h-100 pe-4 px-2" style="height: 65px;">
       <!-- User Role Selector -->
      <div class="role-selector dropdown">
        <button class="role-selector-toggle btn btn-light dropdown-toggle d-flex align-items-center gap-2"
                type="button" id="roleDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="fa fa-user-tag"></i>
          {{ selectedRole || 'Select Role' }}
        </button>

        <ul class="role-selector-menu dropdown-menu mt-2" aria-labelledby="roleDropdown">
          <li *ngFor="let role of roles">
            <a class="role-selector-item dropdown-item" (click)="selectRole(role)">
              <i class="me-2"></i>{{ role }}
            </a>
          </li>
        </ul>
      </div>

      <div class="dropdown">
        <a class="d-flex align-items-center text-decoration-none dropdown-toggle user-dropdown-toggle text-white"
           href="#" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          <img [src]="loggedInUser?.picture || 'images/user-default.png'" alt="User Avatar"
               width="30" height="30" class="rounded-circle me-2 user-avatar">
               @if(isSidebarExpanded){
                <span class="fw-semibold me-2 font-size-10">{{loggedInUser?.name}}</span>
               }
        </a>
      
        <ul class="dropdown-menu shadow-sm p-2 mt-2 ms-2 user-dropdown" data-bs-display="static"
            aria-labelledby="userDropdown">
          <li>
            <a class="dropdown-item d-flex align-items-center gap-2">
              <i class="fa fa-user-cog me-2"></i> Manage Account
            </a>
          </li>
          <li>
            <a class="dropdown-item d-flex align-items-center gap-2">
              <i class="fa fa-gears me-2"></i> Admin Console
            </a>
          </li>
          
          <li><hr class="dropdown-divider"></li>
          <li>
            <a class="dropdown-item d-flex align-items-center gap-2 text-danger" (click)="logout()">
              <i class="fa-solid fa-arrow-right-from-bracket me-2"></i> Logout
            </a>
          </li>
        </ul>
      </div>
      
    </div>
    </div>
  </div>

  <div class="main-content-body">
    <router-outlet></router-outlet>
  </div>
  
</div>




<!-- Recursive Template -->
<ng-template #renderMenu let-items="items" let-isRoot="isRoot" let-depth="depth">
  <ng-container *ngFor="let item of items">
    <li>
      <!-- Menu item with router link -->
      <div
        *ngIf="item.route"
        class="menu-item d-flex align-items-center py-2"
        [routerLink]="item.route"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }"
      >
        <span class="label-content d-flex align-items-center">
          <ng-container *ngIf="isRoot; else subIcon">
            <div class="icon-container me-1">
              <i class="fa" [ngClass]="getMappedIcon(item.icon) || 'fa-atom'"></i>
            </div>
          </ng-container>

          <ng-template #subIcon>
            <i class="fa me-2" [ngClass]="getMappedIcon(item.icon) || 'fa-angle-right'"></i>
          </ng-template>

          <span *ngIf="isSidebarExpanded">{{ item.name }}</span>
        </span>
      </div>

      <!-- Menu item for toggling submenus -->
      <div
        *ngIf="!item.route"
        class="menu-item d-flex align-items-center py-2"
        (click)="item.children?.length ? toggleMenu(item.id) : null"
      >
        <span class="label-content d-flex align-items-center w-100">
          <ng-container *ngIf="isRoot; else subIconLabel">
            <div class="icon-container me-1">
              <i class="fa" [ngClass]="getMappedIcon(item.icon) || 'fa-atom'"></i>
            </div>
          </ng-container>

          <ng-template #subIconLabel>
            <i class="fa me-2" [ngClass]="getMappedIcon(item.icon) || 'fa-angle-right'"></i>
          </ng-template>

          <span *ngIf="isSidebarExpanded" >{{ item.name }}</span>
        </span>
        <i
          *ngIf="item.children?.length"
          class="arrow fa-solid fa-angle-right ms-auto"
          [ngClass]="{ open: isExpanded(item.id) }"
        ></i>
      </div>

      <!-- Submenu -->
      <ul
        *ngIf="item.children?.length && isExpanded(item.id)"
        class="submenu"
        [ngClass]="'depth-' + (depth + 1)"
      >
      <ng-container *ngTemplateOutlet="renderMenu; context: { items: item.children, isRoot: false, depth: depth + 1 }"></ng-container>

      </ul>
    </li>
  </ng-container>
</ng-template>



